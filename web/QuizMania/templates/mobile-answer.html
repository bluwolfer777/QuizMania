<!doctype html>
<html lang="it">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="mobile-style/style.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
    <script src="../static/mobile-js/main.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Answer</title>

</head>
<body class="bg-dark">
    
<div class="mt-4 border border-light-subtle progress">
    <div class="progress-bar" role="progressbar" style="width: 100%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
</div>

<div class="container mt-4 mb-3 p-0 rounded border border-light-subtle">
    <h1>Titolo</h1>
</div>

<div class="container rounded p-3 mb-2 border border-light-subtle" id="question-container">
    <p id="question">Lorem ipsum dolor sit amet, consectetur adipiscing elit,
        sed do eiusmod tempor incididunt ut labore et dolore magna
        aliqua. Ut enim ad minim veniam, quis nostrud exercitation
        ullamco laboris nisi ut aliquip ex ea commodo consequat.
        Duis aute irure dolor in reprehenderit in voluptate velit
        esse cillum dolore eu fugiat nulla pariatur. Excepteur sint
        occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
</div>


<div class="d-grid gap-2">
    <button class="col-12 rounded p-3 my-1 border border-light-subtle btn-answer1" type="button">Button</button>
    <button class="col-12 rounded p-3 my-1 border border-light-subtle btn-answer2" type="button">Button</button>
    <button class="col-12 rounded p-3 my-1 border border-light-subtle btn-answer3" type="button">Button</button>
    <button class="col-12 rounded p-3 my-1 border border-light-subtle btn-answer4" type="button">Button</button>
</div>

<script>
    $(document).ready(function() {
        var questions = []; // Array per memorizzare le domande ricevute dal server
        var currentQuestionIndex = 0; // Indice della domanda corrente
        var timerInterval;
    
        // Funzione per ottenere una nuova domanda dal server
        function getQuestion() {
            $.ajax({
                url: 'api/get-question', // Endpoint API per ottenere la domanda
                method: 'GET',
                success: function(data) {
                    questions.push(data.question);
                    displayQuestion(data.question);
                }
            });
        }
    
        // Funzione per visualizzare una domanda
        function displayQuestion(question) {
            $('#question').text(question);
            startTimer();
        }
    
        // Funzione per avviare il timer di 7 secondi
        function startTimer() {
            var progress = 0;
            var progressInterval = 70; // Tempo per avanzare di 1% della progress bar (70ms per arrivare a 100% in 7 secondi)
            var progressBar = $('.progress-bar');
            timerInterval = setInterval(function() {
                progress += 1;
                progressBar.css('width', progress + '%').attr('aria-valuenow', progress);
                if (progress >= 100) {
                    clearInterval(timerInterval);
                    displayNextQuestion();
                }
            }, progressInterval);
        }
    
        // Funzione per visualizzare la prossima domanda
        function displayNextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                displayQuestion(questions[currentQuestionIndex]);
            } else {
                showResults();
            }
        }
    
        // Funzione per mostrare i risultati
        function showResults() {
            clearInterval(timerInterval);
            $('#question-container').hide();
            $('.progress').hide();
            // Invia le risposte all'API per la valutazione
            $.ajax({
                url: 'api/evaluate-answers',
                method: 'POST',
                data: { answers: questions }, // Invia le risposte all'API per la valutazione
                success: function(data) {
                    displayResult(data);
                }
            });
        }
    
        // Funzione per visualizzare i risultati
        function displayResult(data) {
            var resultContainer = $('#result-container');
            resultContainer.empty();
            resultContainer.show();
            resultContainer.append('<h2>Risposte</h2>');
            var answersList = $('<ul id="answers"></ul>');
            $.each(data.answers, function(index, answer) {
                answersList.append('<li>Domanda: ' + answer.question + ' - Risposta: ' + answer.correct_answer + '</li>');
            });
            answersList.append('<li>Punteggio: ' + data.score + '</li>');
            resultContainer.append(answersList);
        }
    
        // Avvia il quiz
        getQuestion();
    });
    </script>

</body>
</html>
