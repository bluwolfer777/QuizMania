<!doctype html>
<html lang="it">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="../static/mobile-style/style.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
    <script src="../static/mobile-js/main.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Answer</title>

</head>
<body class="bg-dark">
    
<div class="mt-4 border border-light-subtle progress">
    <div class="progress-bar" role="progressbar" style="width: 100%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
</div>

<div class="container mt-4 mb-3 p-0 rounded border border-light-subtle">
    <h1>Titolo</h1>
</div>

<div class="container rounded p-3 mb-2 border border-light-subtle" id="question-container">
    <p>{{ question[0][0] }}</p>
</div>


<div class="d-grid gap-2">
    <form action="/mobile-answer" method="post">

        <input type="text" name="answer" style="display: none">
        <div style="display:none" id="answer_ids">{{ question[0][2] + "," + question[1][2] + "," + question[2][2] +  "," + question[3][2] +}}</div>
        <button onclick="setAnswer(0)" class="col-12 rounded p-3 my-1 border border-light-subtle btn-answer" data-answer="1" type="button">{{ question[0][1] }}</button>
        <button onclick="setAnswer(1)" class="col-12 rounded p-3 my-1 border border-light-subtle btn-answer" data-answer="2" type="button">{{ question[1][1] }}</button>
        <button onclick="setAnswer(2)" class="col-12 rounded p-3 my-1 border border-light-subtle btn-answer" data-answer="3" type="button">{{ question[2][1] }}</button>
        <button onclick="setAnswer(3)" class="col-12 rounded p-3 my-1 border border-light-subtle btn-answer" data-answer="4" type="button">{{ question[3][1] }}</button>
    </form>
</div>

<script>

    function setAnswer(let button){
        let tmp = "";
        let id;
        ids = document.getElementById('answer_ids').innerHtml;
        count = 0;
        for (let i = 0; i < ids; i++) {
            if (ids.charAt(i) == ",") {
                id[count] = tmp;
                count++;
                tmp = "";
            }
            else {
            tmp += ids.charAt(i);
            }
        }
        document.getElementById('answer').value = id[button]
    }

$(document).ready(function() {
    // Funzione per ottenere la domanda dal server e aggiornare il contenuto della pagina
    function getQuestion() {
        $.ajax({
            url: '/mobile-answer', // URL dell'endpoint API Flask
            method: 'GET',
            success: function(data) {
                $('#question').text(data);  // Aggiorna il contenuto del paragrafo con l'ID "question" con la domanda ricevuta
            },
            error: function(xhr, status, error) {
                console.error(error);  // Gestisci eventuali errori
            }
        });
    }

    // Funzione per inviare la risposta dell'utente al server
    function sendAnswer(answer) {
        $.ajax({
            url: '/mobile-answer', // URL dell'endpoint API Flask per inviare la risposta
            method: 'POST',
            data: { answer: answer },  // Invia la risposta senza utilizzare JSON
            success: function(response) {
                console.log(response);  // Gestisci la risposta dal server
            },
            error: function(xhr, status, error) {
                console.error(error);  // Gestisci eventuali errori
            }
        });
    }

    // Gestione del click sui pulsanti delle risposte
    $('.btn-answer').click(function() {
        var selectedAnswer = $(this).data('answer');  // Ottieni l'ID della risposta selezionata
        sendAnswer(selectedAnswer);  // Invia la risposta al server
    });

    // Chiamata alla funzione per ottenere la domanda all'avvio della pagina
    getQuestion();
});
</script>

</body>
</html>
